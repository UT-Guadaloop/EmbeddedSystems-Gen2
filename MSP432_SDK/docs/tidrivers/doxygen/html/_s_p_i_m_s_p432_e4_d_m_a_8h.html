<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>SPIMSP432E4DMA.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link id="favicon" rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="tiapistylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="https://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2298ed0e5bfee6f293aea6c715ac7f7c.html">exports</a></li><li class="navelem"><a class="el" href="dir_a59555fa6928a28ba1fd94639418fed2.html">tidrivers_msp432e4</a></li><li class="navelem"><a class="el" href="dir_881bc3ea3e0b6773ef082a7a8f546747.html">source</a></li><li class="navelem"><a class="el" href="dir_d200e2eb2d76e462bf7bb2f8b0aadb1e.html">ti</a></li><li class="navelem"><a class="el" href="dir_c7c3caac9c05bea82305b87d191db62d.html">drivers</a></li><li class="navelem"><a class="el" href="dir_d8b22eb2dbf757fd327a7736e77db69e.html">spi</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">SPIMSP432E4DMA.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>SPI driver implementation for a MSP432E4 SPI controller using the micro DMA controller. </p>
<hr/>
<p>The SPI header file should be included in an application as follows: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_s_p_i_8h.html">ti/drivers/SPI.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="_s_p_i_m_s_p432_e4_d_m_a_8h.html">ti/drivers/spi/SPIMSP432E4DMA.h</a>&gt;</span></div></div><!-- fragment --><p>Refer to <a class="el" href="_s_p_i_8h.html">SPI.h</a> for a complete description of APIs &amp; example of use.</p>
<p>This SPI driver implementation is designed to operate on a MSP432E4 SPI controller using a micro DMA controller in ping pong mode. This driver allows for queueing multiple SPI transactions.</p>
<h2>Frame Formats</h2>
<p>This SPI controller supports 4 phase &amp; polarity formats as well as the TI synchronous serial frame format. Refer to the device specific data sheets &amp; technical reference manuals for specifics on each format.</p>
<h2>SPI Chip Select</h2>
<p>This SPI controller supports a hardware chip select pin. Refer to the device's user manual on how this hardware chip select pin behaves in regards to the SPI frame format.</p>
<table class="doxtable">
<tr>
<th>Chip select type </th><th>SPI_MASTER mode </th><th>SPI_SLAVE mode  </th></tr>
<tr>
<td>Hardware chip select </td><td>No action is needed by the application to select the peripheral. </td><td>See the device documentation on it's chip select requirements.  </td></tr>
<tr>
<td>Software chip select </td><td>The application is responsible to ensure that correct SPI slave is selected before performing a <a class="el" href="_s_p_i_8h.html#a989e17f96b54fcc3dc2cac5f8ac6bdb2" title="Function to perform SPI transactions. ">SPI_transfer()</a>. </td><td>See the device documentation on it's chip select requirements.  </td></tr>
</table>
<h2>SPI data frames</h2>
<p>SPI data frames can be any size from 4-bits to 16-bits. If the dataSize in <a class="el" href="struct_s_p_i___params.html" title="SPI Parameters. ">SPI_Params</a> is greater than 8-bits, then the SPIMSP432E4DMA driver will assume that the <a class="el" href="struct_s_p_i___transaction.html" title="A SPI_Transaction data structure is used with SPI_transfer(). It indicates how many SPI_FrameFormat f...">SPI_Transaction</a> txBuf and rxBuf point to 16-bit (uint16_t) arrays.</p>
<table class="doxtable">
<tr>
<th>dataSize </th><th>buffer element size  </th></tr>
<tr>
<td>4-8 bits </td><td>uint8_t </td></tr>
<tr>
<td>9-16 bits </td><td>uint16_t </td></tr>
</table>
<p>Data buffers in transactions (rxBuf &amp; txBuf) must be address aligned according to the data frame size. For example, if data frame is 9-bit or larger (driver assumes buffers are uint16_t) rxBuf &amp; txBuf must be aligned on a 16-bit address boundary.</p>
<h2>Interrupts</h2>
<p>This driver is designed to make use of the micro DMA for transfers. The driver implementation automatically installs a hardware interrupt service routine for the peripheral on which micro DMA generates IRQ once all data has transfered from memory to the peripheral (TX) or from peripheral to memory (RX).</p>
<h2>DMA and Queueing</h2>
<p>This driver utilizes DMA channels in ping pong mode (see device TRM) in order to overcome the 1024 item DMA channel limit. This means the driver can execute multi kilo-item transactions without pausing to reconfigure the DMA and causing gaps in transmission. In addition, the driver also allows the user to queue up transfers when opened in <a class="el" href="_s_p_i_8h.html#ab9ea76c6529d6076eee5e1c4a5a92c6fa5631e69925c47a62a261c78ebbda39fb">SPI_MODE_CALLBACK</a> by calling <a class="el" href="_s_p_i_8h.html#a989e17f96b54fcc3dc2cac5f8ac6bdb2" title="Function to perform SPI transactions. ">SPI_transfer()</a> multiple times. Note that each transaction's <a class="el" href="struct_s_p_i___transaction.html" title="A SPI_Transaction data structure is used with SPI_transfer(). It indicates how many SPI_FrameFormat f...">SPI_Transaction</a> struct must still be persistent and unmodified until that transaction is complete.</p>
<p><a class="anchor" id="ti_drivers_spi_SPIMSP432E4DMA_example_queueing"></a> Below is an example of queueing three transactions </p><div class="fragment"><div class="line"><span class="comment">// SPI already opened in callback mode</span></div><div class="line"><a class="code" href="struct_s_p_i___transaction.html">SPI_Transaction</a> t0, t1, t2;</div><div class="line"></div><div class="line">t0.<a class="code" href="struct_s_p_i___transaction.html#a9461a248f1cceb4048668d44b323a0b8">txBuf</a> = txBuff0;</div><div class="line">t0.<a class="code" href="struct_s_p_i___transaction.html#a214f57d7809c875fb9456a62a406e041">rxBuf</a> = rxBuff0;</div><div class="line">t0.<a class="code" href="struct_s_p_i___transaction.html#ad049d6a900c4bdb59a5ee8ce3d5bced2">count</a> = 2000;</div><div class="line"></div><div class="line">t1.<a class="code" href="struct_s_p_i___transaction.html#a9461a248f1cceb4048668d44b323a0b8">txBuf</a> = txBuff1;</div><div class="line">t1.<a class="code" href="struct_s_p_i___transaction.html#a214f57d7809c875fb9456a62a406e041">rxBuf</a> = rxBuff1;</div><div class="line">t1.<a class="code" href="struct_s_p_i___transaction.html#ad049d6a900c4bdb59a5ee8ce3d5bced2">count</a> = 1000;</div><div class="line"></div><div class="line">t2.<a class="code" href="struct_s_p_i___transaction.html#a9461a248f1cceb4048668d44b323a0b8">txBuf</a> = txBuff2;</div><div class="line">t2.<a class="code" href="struct_s_p_i___transaction.html#a214f57d7809c875fb9456a62a406e041">rxBuf</a> = NULL;</div><div class="line">t2.<a class="code" href="struct_s_p_i___transaction.html#ad049d6a900c4bdb59a5ee8ce3d5bced2">count</a> = 1000;</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> transferOk = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="_s_p_i_8h.html#a989e17f96b54fcc3dc2cac5f8ac6bdb2">SPI_transfer</a>(spiHandle, &amp;t0)) {</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="_s_p_i_8h.html#a989e17f96b54fcc3dc2cac5f8ac6bdb2">SPI_transfer</a>(spiHandle, &amp;t1)) {</div><div class="line">            transferOk = <a class="code" href="_s_p_i_8h.html#a989e17f96b54fcc3dc2cac5f8ac6bdb2">SPI_transfer</a>(spiHandle, &amp;t2);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h2>DMA accessible memory</h2>
<p>As this driver uses uDMA to transfer data to/from data buffers, it is the responsibility of the application to ensure that theses buffers reside in memory that is accessible by the DMA.</p>
<h2>NULL Buffers</h2>
<p>When <a class="el" href="struct_s_p_i___transaction.html#a214f57d7809c875fb9456a62a406e041">SPI_Transaction.rxBuf</a> is NULL, all frames received will be discarded. When <a class="el" href="struct_s_p_i___transaction.html#a9461a248f1cceb4048668d44b323a0b8">SPI_Transaction.txBuf</a> is NULL, an internal scratch buffer is initialized to <a class="el" href="struct_s_p_i_m_s_p432_e4_d_m_a___h_w_attrs.html#a0f097b5ac5669ce75e2c5cb770f55863">SPIMSP432E4DMA_HWAttrs.defaultTxBufValue</a> so the uDMA will send some known value.</p>
<h2>Polling SPI transfers</h2>
<p>When used in blocking mode small SPI transfers are can be done by polling the peripheral &amp; sending data frame-by-frame. For master devices this will not block since the transfer can happen immediately. Slaves must exercise caution since the call will poll on the HW until the transfer is complete. For this reason slaves with a transfer timeout will not use polling transfers. The minDmaTransferSize field in the hardware attributes is the threshold; if the transaction count is below the threshold a polling transfer is performed; otherwise a DMA transfer is done. This is intended to reduce the overhead of setting up a DMA transfer to only send a few data frames.</p>
<p>Notes:</p><ul>
<li>Specifying a timeout prevents slave devices from using polling transfers.</li>
<li>Keep in mind that during polling transfers the current task is still being executed; there is no context switch to another task.</li>
</ul>
<hr/>
 </div><div class="textblock"><code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;ti/devices/msp432e4/inc/msp432.h&gt;</code><br />
<code>#include &lt;ti/devices/msp432e4/driverlib/pin_map.h&gt;</code><br />
<code>#include &lt;<a class="el" href="_u_d_m_a_m_s_p432_e4_8h_source.html">ti/drivers/dma/UDMAMSP432E4.h</a>&gt;</code><br />
<code>#include &lt;ti/drivers/dpl/HwiP.h&gt;</code><br />
<code>#include &lt;ti/drivers/dpl/SemaphoreP.h&gt;</code><br />
<code>#include &lt;<a class="el" href="_g_p_i_o_m_s_p432_e4_8h_source.html">ti/drivers/gpio/GPIOMSP432E4.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="_s_p_i_8h_source.html">ti/drivers/SPI.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for SPIMSP432E4DMA.h:</div>
<div class="dyncontent">
<div class="center"><img src="_s_p_i_m_s_p432_e4_d_m_a_8h__incl.png" border="0" usemap="#_s_p_i_m_s_p432_e4_d_m_a_8h" alt=""/></div>
<map name="_s_p_i_m_s_p432_e4_d_m_a_8h" id="_s_p_i_m_s_p432_e4_d_m_a_8h">
<area shape="rect" id="node6" href="_u_d_m_a_m_s_p432_e4_8h.html" title="uDMA driver implementation for MSP432E4. " alt="" coords="89,87,312,114"/>
<area shape="rect" id="node9" href="_g_p_i_o_m_s_p432_e4_8h.html" title="MSP432E4 GPIO driver. " alt="" coords="571,87,785,114"/>
<area shape="rect" id="node12" href="_s_p_i_8h.html" title="Serial Peripheral Interface (SPI) Driver Interface. " alt="" coords="437,87,546,114"/>
<area shape="rect" id="node11" href="_g_p_i_o_8h.html" title="General Purpose I/O driver interface. " alt="" coords="631,177,751,203"/>
</map>
</div>
</div>
<p><a href="_s_p_i_m_s_p432_e4_d_m_a_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_s_p_i_m_s_p432_e4_d_m_a___h_w_attrs.html">SPIMSP432E4DMA_HWAttrs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPIMSP432E4DMA Hardware attributes.  <a href="struct_s_p_i_m_s_p432_e4_d_m_a___h_w_attrs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_s_p_i_m_s_p432_e4_d_m_a___object.html">SPIMSP432E4DMA_Object</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae2bb4bf8fcafd5d8b30e881f97edbc79"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_m_s_p432_e4_d_m_a_8h.html#ae2bb4bf8fcafd5d8b30e881f97edbc79">SPIMSP432E4_PIN_NO_CONFIG</a>&#160;&#160;&#160;(0xFFFFFFFF)</td></tr>
<tr class="memdesc:ae2bb4bf8fcafd5d8b30e881f97edbc79"><td class="mdescLeft">&#160;</td><td class="mdescRight">SPIMSP432E4_PIN_NO_CONFIG can be used to inform the SPIMSP432E4DMA driver that a pin should not be configured for use in the SPI bus. If the MOSI pin, MISO pin or FSS is set to SPIMSP432E4_PIN_NO_CONFIG in the <a class="el" href="struct_s_p_i_m_s_p432_e4_d_m_a___h_w_attrs.html" title="SPIMSP432E4DMA Hardware attributes. ">SPIMSP432E4DMA_HWAttrs</a>, the pin is not configured to SPI functionality in <a class="el" href="_s_p_i_8h.html#a9c9022decfb136991d6b53f7dd2ae2fc" title="This function opens a given SPI peripheral. ">SPI_open()</a> and the pin can be used for another function. The clkPin cannot be set to SPIMSP432E4_PIN_NO_CONFIG; the clock signal is always required during communication &amp; must be driven by the SPI bus master.  <a href="#ae2bb4bf8fcafd5d8b30e881f97edbc79">More...</a><br /></td></tr>
<tr class="separator:ae2bb4bf8fcafd5d8b30e881f97edbc79"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3654610d892fa54e3c7ff2ef7586fc16"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="struct_s_p_i___fxn_table.html">SPI_FxnTable</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_s_p_i_m_s_p432_e4_d_m_a_8h.html#a3654610d892fa54e3c7ff2ef7586fc16">SPIMSP432E4DMA_fxnTable</a></td></tr>
<tr class="separator:a3654610d892fa54e3c7ff2ef7586fc16"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae2bb4bf8fcafd5d8b30e881f97edbc79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2bb4bf8fcafd5d8b30e881f97edbc79">&sect;&nbsp;</a></span>SPIMSP432E4_PIN_NO_CONFIG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SPIMSP432E4_PIN_NO_CONFIG&#160;&#160;&#160;(0xFFFFFFFF)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SPIMSP432E4_PIN_NO_CONFIG can be used to inform the SPIMSP432E4DMA driver that a pin should not be configured for use in the SPI bus. If the MOSI pin, MISO pin or FSS is set to SPIMSP432E4_PIN_NO_CONFIG in the <a class="el" href="struct_s_p_i_m_s_p432_e4_d_m_a___h_w_attrs.html" title="SPIMSP432E4DMA Hardware attributes. ">SPIMSP432E4DMA_HWAttrs</a>, the pin is not configured to SPI functionality in <a class="el" href="_s_p_i_8h.html#a9c9022decfb136991d6b53f7dd2ae2fc" title="This function opens a given SPI peripheral. ">SPI_open()</a> and the pin can be used for another function. The clkPin cannot be set to SPIMSP432E4_PIN_NO_CONFIG; the clock signal is always required during communication &amp; must be driven by the SPI bus master. </p>
<p>Prevent pin defines from cluttering doxygen</p>
<p>Setting pins to SPIMSP432E4_PIN_NO_CONFIG can be useful in the following situations:</p><ol type="1">
<li>MOSI = SPIMSP432E4_PIN_NO_CONFIG: Useful in situations where the master will not transmit meaningful data but instead is interested in receiving data from slaves. Slaves must ignore incoming data from master.</li>
<li>MOSI = SPIMSP432E4_PIN_NO_CONFIG: Useful in situations where the SPI bus master will transmit data to the slaves &amp; is not interested in the data returned by the slaves.</li>
<li>FSS = SPIMSP432E4_PIN_NO_CONFIG: Useful in situations the FSS (chip select) pin will be handled by the application instead of automatically by the hardware. This is useful when the SPI master has to communicate with multiple slaves. Slaves cannot set FSS to SPIMSP432E4_PIN_NO_CONFIG. </li>
</ol>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a3654610d892fa54e3c7ff2ef7586fc16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3654610d892fa54e3c7ff2ef7586fc16">&sect;&nbsp;</a></span>SPIMSP432E4DMA_fxnTable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="struct_s_p_i___fxn_table.html">SPI_FxnTable</a> SPIMSP432E4DMA_fxnTable</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><small>
  <a href="https://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
  <a href="https://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="https://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="https://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="https://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>
</small>
</body>
</html>
